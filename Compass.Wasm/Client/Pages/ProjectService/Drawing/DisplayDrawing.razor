@using Compass.Wasm.Shared.ProjectService
@inject HttpClient Http
<tr>
    <td>
        <a href="@($"./updatedrawing/{Drawing.Id}")"><i class="bi bi-gear" /></a>
        <span style="font-weight: bold">@Drawing.ItemNumber</span><br />
        <span>图纸：</span><br />
        @if (!string.IsNullOrWhiteSpace(Drawing.DrawingUrl))
        {
            foreach (var fileUrl in Drawing.DrawingUrl.Split('\n'))
            {
                <a href="@fileUrl" target="_blank">@(Path.GetFileName(fileUrl))</a>
                <br />
            }
        }
    </td>
    <td>
        <a href="@($"./modulelist/{Drawing.Id}")"><i class="bi bi-gear" /></a>
        @if (modules != null && modules.Length != 0)
        {
            foreach (var module in modules)
            {
                <p>
                    <i class="bi bi-bullseye" />
                    <span style="font-weight: bold">@module.Name</span> <span>@module.Name</span><br />
                    @if (!string.IsNullOrWhiteSpace(module.SpecialNotes))
                    {
                        foreach (var note in module.SpecialNotes.Split('\n'))
                        {
                            <span style="color: blue">@note</span><br />
                        }
                    }
                </p>
            }
        }
    </td>
</tr>

@code {
    [Parameter]
    public DrawingResponse Drawing { get; set; }

    private ModuleResponse[]? modules;

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        modules=await Http.GetFromJsonAsync<ModuleResponse[]>($"api/Module/All/{Drawing.Id}");
    }

}
